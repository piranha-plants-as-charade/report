\subsection{Audio Export}
\label{sec:audio_export}

The final phase of Piranha Plants as Charade is to export the generated song from Part \ref{sec:accompaniment_generation} as a WAV file, a standard audio format. This step is comprised of two independent parts: 1) a pipeline that uses custom samples to handle the vocal parts; and 2) a pipeline that leverages the MIDI standard to handle all other instruments. The two results are added component-wise to generate the overall output.

\subsubsection{MIDI-Based Pipeline}

By building around the MIDI standard, the bulk of this step is handled by external programs. First, the appropriate song data is written to a MIDI file using MIDIUtil, a Python library. Next, the generated file is converted into a WAV file using FluidSynth, an open-source audio synthesizer, and the ``MS Basic'' soundfont\footnote{A file format that contains instrument sample data.} by MuseScore. We originally implemented this approach as a prototype, but since it worked well out-of-the-box, we decided to keep this process.

\subsubsection{Pipeline for Vocals}

Although the MIDI-based approach was sufficient for exporting our song as a WAV file, we wanted more customizablity than the process allowed for handling vocals. As such, we designed a specialized pipeline to export the vocal parts. We repurposed some voice samples from the video game \emph{Animal Crossing: New Horizons} as the base samples for each voiced syllable, and to export a note for a given syllable, we pitch-shifted the respective base sample accordingly. We post-processed each exported note to better fit in the overall audio mix. We first applied a low-pass Butterworth filter to reduce dissonance in the high registers, then we applied a volume envelope based on a modified Hamming window to smoothen the start and end of each note.

We found it surprisingly difficult to implement pitch-shifting. Our initial attempt used stock DSP algorithms from librosa and other audio processing libraries, but the vocal qualities would become distorted beyond recognition for large shifts. Next, we experimented with formant\footnote{The audio characteristics of spoken sounds.}-preservation techniques, but we were unsatisfied with the robotic-sounding artifacts. In the end, we pitch-shifted the base samples by hand using Melodyne, a commercial software designed for pitch manipulation, and we stored the outputs to be accessed on demand. Although this approach provided us with the highest quality audio samples, it required a lot of manual work and imposed a cap on the supported pitch range. Nonetheless, audio quality was our top priority, so the Melodyne approach was worth the downsides.